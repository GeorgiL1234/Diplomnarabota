# ДОКУМЕНТАЦИЯ НА ПРОЕКТА
## Web Shop - Платформа за обяви и продажби

**Версия:** 1.0  
**Дата:** Февруари 2026  
**Автор:** Георги Лазаров  
**Университет:** [Име на университет]  
**Специалност:** [Специалност]

---

## Съдържание

1. [Въведение](#1-въведение)
2. [Общ преглед на проекта](#2-общ-преглед-на-проекта)
3. [Архитектура на системата](#3-архитектура-на-системата)
4. [Технологичен стек](#4-технологичен-стек)
5. [Инсталация и конфигурация](#5-инсталация-и-конфигурация)
6. [Описание на функционалностите](#6-описание-на-функционалностите)
7. [API Документация](#7-api-документация)
8. [База данни](#8-база-данни)
9. [Frontend Архитектура](#9-frontend-архитектура)
10. [Backend Архитектура](#10-backend-архитектура)
11. [Сигурност](#11-сигурност)
12. [Тестване](#12-тестване)
13. [Разполагане](#13-разполагане)
14. [Бъдещи подобрения](#14-бъдещи-подобрения)
15. [Приложения](#15-приложения)

---

## 1. Въведение

### 1.1. Цел на документацията

Настоящата документация описва разработката, архитектурата, функционалностите и използването на Web Shop платформата - модерна уеб базирана система за обяви и продажби. Документацията е предназначена за разработчици, администратори и потребители на системата.

### 1.2. Обхват на проекта

Web Shop е пълнофункционална платформа за онлайн обяви, която позволява на потребителите да:
- Регистрират се и влизат в системата
- Създават и управляват собствени обяви
- Разглеждат обяви от различни категории
- Плащат за VIP статус на обявите
- Създават поръчки
- Комуникират чрез вградена система за съобщения
- Използват системата на три езика (български, английски, руски)

### 1.3. Целева аудитория

Документацията е предназначена за:
- **Разработчици** - които ще поддържат и разширяват системата
- **Системни администратори** - които ще разполагат и управляват системата
- **Тестери** - които ще тестват функционалностите
- **Потребители** - които ще използват системата

### 1.4. Структура на документацията

Документацията е организирана в логически раздели, които покриват всички аспекти на системата - от архитектурата и технологичния стек до детайлно описание на функционалностите и API endpoints.

---

## 2. Общ преглед на проекта

### 2.1. Описание на системата

Web Shop е модерна уеб базирана платформа за обяви и продажби, разработена с използване на съвременни технологии. Системата предоставя интуитивен интерфейс за управление на обяви, комуникация между потребители и обработка на поръчки.

### 2.2. Основни цели

Основните цели на проекта са:
- **Лекота на използване** - интуитивен и модерен потребителски интерфейс
- **Многоезичност** - поддръжка на български, английски и руски език
- **Безопасност** - защита на потребителските данни и транзакции
- **Масштабируемост** - възможност за разширяване на функционалностите
- **Производителност** - бърза работа и отзивчивост

### 2.3. Ключови функционалности

Системата включва следните ключови функционалности:

1. **Управление на потребители**
   - Регистрация и вход
   - Управление на профили
   - Автентификация и авторизация

2. **Управление на обяви**
   - Създаване, редактиране и изтриване на обяви
   - Качване на снимки
   - Категоризация на обяви
   - VIP статус за обяви

3. **Система за плащания**
   - Интеграция със Stripe за VIP плащания
   - Обработка на картови плащания
   - Управление на транзакции

4. **Система за поръчки**
   - Създаване на поръчки
   - Управление на статуси на поръчки
   - История на поръчките

5. **Комуникация**
   - Система за съобщения между потребители
   - Уведомления

6. **Многоезичност**
   - Поддръжка на три езика
   - Динамично превключване на езика

### 2.4. Технически изисквания

Системата изисква:
- **Backend:** Java 17+, Spring Boot 3.2.2+
- **Frontend:** Node.js 18+, React 19+
- **База данни:** H2 Database (file-based)
- **Сървър:** Минимум 512MB RAM, 1GB дисково пространство

---

## 3. Архитектура на системата

### 3.1. Обща архитектура

Web Shop следва трислойна архитектура (3-tier architecture):

```
┌─────────────────────────────────────────┐
│         Presentation Layer               │
│         (React Frontend)                 │
│  - UI Components                         │
│  - State Management                      │
│  - API Communication                    │
└─────────────────────────────────────────┘
                    │
                    │ HTTP/REST API
                    │
┌─────────────────────────────────────────┐
│         Application Layer                │
│         (Spring Boot Backend)            │
│  - REST Controllers                     │
│  - Business Logic (Services)            │
│  - Security & Authentication            │
└─────────────────────────────────────────┘
                    │
                    │ JPA/Hibernate
                    │
┌─────────────────────────────────────────┐
│         Data Layer                       │
│         (H2 Database)                    │
│  - Entities & Relationships             │
│  - Data Persistence                     │
└─────────────────────────────────────────┘
```

### 3.2. Frontend Архитектура

Frontend-ът е изграден с React и следва компонентно-базирана архитектура:

```
App.tsx (Main Component)
├── Header Component
│   ├── Navigation
│   └── Language Selector
├── RegisterPage Component
├── LoginPage Component
├── CreateListingForm Component
├── ItemList Component
│   └── ItemCard Component
├── ItemDetail Component
├── VipListingsPage Component
├── VipPaymentForm Component
├── MessagesPage Component
└── OrdersPage Component
```

### 3.3. Backend Архитектура

Backend-ът следва MVC (Model-View-Controller) архитектура:

```
Controllers Layer
├── AuthController
├── ItemController
├── FileUploadController
├── OrderController
├── VipController
└── VipPaymentController

Services Layer
├── UserService
├── ItemService
├── OrderService
├── VipPaymentService
└── MessageService

Repositories Layer
├── UserRepository
├── ItemRepository
├── OrderRepository
├── VipPaymentRepository
└── MessageRepository

Models Layer
├── User
├── Item
├── Order
├── VipPayment
├── Review
└── Message
```

### 3.4. Комunikация между слоевете

Комunikацията между frontend и backend се осъществява чрез RESTful API:

- **Протокол:** HTTP/HTTPS
- **Формат на данни:** JSON
- **Методи:** GET, POST, PUT, DELETE
- **Автентификация:** Session-based (email в localStorage)

### 3.5. Поток на данни

Типичен поток на данни при създаване на обява:

1. Потребителят попълва формата във frontend
2. Frontend изпраща POST заявка към `/items`
3. Backend валидира данните
4. Backend записва обявата в базата данни
5. Backend връща успешен response
6. Frontend показва съобщение за успех
7. Frontend качва снимката чрез POST към `/upload/{itemId}`
8. Backend обработва снимката и я записва като base64
9. Frontend обновява списъка с обяви

---

## 4. Технологичен стек

### 4.1. Frontend Технологии

#### 4.1.1. React 19.2.0
React е използван като основна библиотека за изграждане на потребителския интерфейс. Предимства:
- Компонентно-базирана архитектура
- Реактивен рендеринг
- Голяма общност и поддръжка
- Богата екосистема от библиотеки

#### 4.1.2. TypeScript 5.9.3
TypeScript осигурява статична типизация за JavaScript:
- По-добра поддръжка от IDE
- Ранно откриване на грешки
- По-добра поддръжка на кода
- Автоматично документиране

#### 4.1.3. Vite 7.2.4
Vite е използван като build tool и development server:
- Бързо стартиране на development server
- Бърз hot module replacement (HMR)
- Оптимизирани production builds
- Поддръжка на TypeScript out-of-the-box

#### 4.1.4. CSS3
За стилизация се използва чист CSS3:
- CSS Variables за темизация
- Flexbox и Grid за layout
- Responsive design
- Custom animations

### 4.2. Backend Технологии

#### 4.2.1. Java 17
Java 17 е използван като основен език за програмиране:
- LTS (Long Term Support) версия
- Модерни езикови функции
- Отлична производителност
- Широка поддръжка

#### 4.2.2. Spring Boot 3.2.2
Spring Boot е използван като основен framework:
- Автоматична конфигурация
- Вградени сървъри (Tomcat)
- Интеграция с Spring Security
- Spring Data JPA за работа с база данни

#### 4.2.3. Spring Security
За сигурност се използва Spring Security:
- Автентификация и авторизация
- CORS конфигурация
- CSRF защита
- Session management

#### 4.2.4. Spring Data JPA
За работа с база данни се използва Spring Data JPA:
- Автоматично генериране на SQL заявки
- Entity relationships
- Transaction management
- Repository pattern

#### 4.2.5. H2 Database
H2 е използван като embedded база данни:
- Лека и бърза
- File-based персистентност
- SQL стандартна
- Подходяща за development и малки production системи

#### 4.2.6. Stripe Java SDK 24.16.0
За обработка на плащания се използва Stripe:
- Безопасна обработка на картови плащания
- PCI DSS compliance
- Поддръжка на различни валути
- Детайлна документация

### 4.3. Инструменти за разработка

- **Git** - Version control
- **Maven** - Dependency management за Java
- **npm** - Package management за JavaScript
- **ESLint** - Code linting за JavaScript/TypeScript
- **Postman/curl** - Тестване на API endpoints

### 4.4. Deployment платформи

- **Vercel** - Frontend hosting
- **Render.com** - Backend hosting
- **GitHub** - Source code repository

---

## 5. Инсталация и конфигурация

### 5.1. Системни изисквания

#### 5.1.1. За разработка

- **Java Development Kit (JDK) 17 или по-нова версия**
- **Node.js 18 или по-нова версия**
- **npm 9 или по-нова версия**
- **Maven 3.8 или по-нова версия**
- **Git**
- **IDE** (IntelliJ IDEA, Eclipse, или VS Code)

#### 5.1.2. За production

- **Java Runtime Environment (JRE) 17+**
- **Минимум 512MB RAM**
- **Минимум 1GB дисково пространство**
- **Интернет връзка**

### 5.2. Инсталация на Backend

#### 5.2.1. Клониране на repository

```bash
git clone https://github.com/GeorgiL1234/Diplomnarabota.git
cd Diplomnarabota/backend/web-shop
```

#### 5.2.2. Конфигуриране на база данни

Файлът `src/main/resources/application.properties` съдържа конфигурацията:

```properties
# Database configuration
spring.datasource.url=jdbc:h2:file:./data/webshopdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA configuration
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
```

#### 5.2.3. Конфигуриране на файлови uploads

```properties
# File upload settings
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=20MB
spring.servlet.multipart.max-request-size=20MB
spring.servlet.multipart.file-size-threshold=0
```

#### 5.2.4. Конфигуриране на Stripe

Добавете environment variable:
```bash
export STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
```

Или в `application.properties`:
```properties
stripe.secret.key=${STRIPE_SECRET_KEY:}
```

#### 5.2.5. Компилиране и стартиране

```bash
# Компилиране
mvn clean install

# Стартиране
mvn spring-boot:run
```

Backend-ът ще стартира на `http://localhost:8080`

### 5.3. Инсталация на Frontend

#### 5.3.1. Навигация до frontend директория

```bash
cd ../web-shop-frontend
```

#### 5.3.2. Инсталиране на зависимости

```bash
npm install
```

#### 5.3.3. Конфигуриране на API endpoint

Редактирайте `src/config.ts`:

```typescript
export const API_BASE = process.env.VITE_API_BASE || "http://localhost:8080";
```

Или създайте `.env` файл:
```
VITE_API_BASE=http://localhost:8080
```

#### 5.3.4. Стартиране на development server

```bash
npm run dev
```

Frontend-ът ще стартира на `http://localhost:5173`

#### 5.3.5. Building за production

```bash
npm run build
```

Build-натите файлове ще бъдат в `dist/` директорията.

### 5.4. Конфигуриране на CORS

CORS е конфигуриран в `CorsConfig.java`:

```java
configuration.setAllowedOrigins(List.of("*"));
configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
configuration.setAllowedHeaders(List.of("*"));
```

За production, ограничете origins до конкретни домейни.

### 5.5. Environment Variables

#### 5.5.1. Backend Environment Variables

- `STRIPE_SECRET_KEY` - Stripe secret key за плащания
- `SPRING_PROFILES_ACTIVE` - Active Spring profile (production, development)

#### 5.5.2. Frontend Environment Variables

- `VITE_API_BASE` - Backend API base URL

---

## 6. Описание на функционалностите

### 6.1. Управление на потребители

#### 6.1.1. Регистрация

Потребителите могат да се регистрират като предоставят:
- **Email адрес** (задължително, уникален)
- **Парола** (минимум 8 символа, поне един специален символ)
- **Пълно име** (задължително)

Процесът на регистрация:
1. Потребителят попълва формата
2. Frontend валидира данните
3. Frontend изпраща POST заявка към `/auth/register`
4. Backend проверява дали email-ът вече съществува
5. Backend хешира паролата с BCrypt
6. Backend създава нов потребител
7. Потребителят автоматично влиза в системата

#### 6.1.2. Вход в системата

Потребителите могат да влязат като предоставят:
- **Email адрес**
- **Парола**

Процесът на вход:
1. Потребителят въвежда credentials
2. Frontend изпраща POST заявка към `/auth/login`
3. Backend проверява email и парола
4. Backend сравнява паролата с хеша в базата данни
5. При успех, email-ът се запазва в localStorage
6. Потребителят е логнат

#### 6.1.3. Изход от системата

При изход:
1. Email-ът се премахва от localStorage
2. Потребителят се пренасочва към началната страница

### 6.2. Управление на обяви

#### 6.2.1. Създаване на обява

Потребителите могат да създават обяви като предоставят:
- **Заглавие** (задължително)
- **Описание** (задължително)
- **Цена** (задължително, по-голяма от 0, в EUR)
- **Категория** (избор от предварително дефинирани)
- **Контактна информация** (email или телефон, поне едно задължително)
- **Начин на плащане** (Наложен платеж или Банков път)
- **Снимка** (задължителна)
- **VIP статус** (опционално, срещу плащане от 2€)

Процесът на създаване:
1. Потребителят попълва формата
2. Frontend валидира данните
3. Frontend компресира снимката (ако е необходимо)
4. Frontend изпраща POST заявка към `/items`
5. Backend валидира и създава обявата
6. Ако е избран VIP статус, се показва форма за плащане
7. Frontend качва снимката чрез POST към `/upload/{itemId}`
8. Backend обработва и записва снимката като base64

#### 6.2.2. Преглед на обяви

Потребителите могат да:
- Разглеждат всички обяви
- Филтрират по категория
- Разглеждат само VIP обяви
- Разглеждат собствените си обяви
- Отварят детайли за конкретна обява

Обявите се сортират автоматично - VIP обявите се показват първи.

#### 6.2.3. Редактиране на обява

Собствениците могат да редактират своите обяви:
- Промяна на заглавие, описание, цена
- Промяна на категория
- Промяна на контактна информация
- Качване на нова снимка

#### 6.2.4. Изтриване на обява

Собствениците могат да изтриват своите обяви. При изтриване се изтриват и всички свързани данни (поръчки, ревюта, съобщения).

### 6.3. VIP Система

#### 6.3.1. Активиране на VIP статус

Потребителите могат да активират VIP статус за своите обяви срещу плащане от 2€:
1. При създаване на обява, потребителят избира "Направи обявата VIP"
2. След създаване на обявата, се показва форма за плащане
3. Потребителят попълва данните на картата:
   - Номер на карта
   - Име на картодържателя
   - Дата на изтичане (MM/YY)
   - CVV код
4. Frontend валидира данните (Luhn алгоритъм за картата)
5. Frontend изпраща заявка за създаване на плащане към `/vip-payment/create`
6. Backend създава VipPayment запис
7. Frontend изпраща заявка за завършване на плащане към `/vip-payment/complete`
8. Backend обработва плащането чрез Stripe (ако е конфигуриран)
9. Backend активира VIP статуса на обявата
10. Обявата се показва с VIP badge и се сортира първа

#### 6.3.2. VIP Обяви страница

Съществува отделна страница за VIP обяви, която показва само обяви с активен VIP статус.

### 6.4. Система за поръчки

#### 6.4.1. Създаване на поръчка

Потребителите могат да създават поръчки за обяви:
1. Потребителят отваря детайли за обява
2. Попълва формата за поръчка:
   - Име на клиента
   - Телефон на клиента
   - Email на клиента
   - Начин на плащане
   - Начин на доставка
   - Адрес за доставка
3. Frontend изпраща POST заявка към `/item-orders`
4. Backend създава поръчката
5. Потребителят получава потвърждение

#### 6.4.2. Управление на поръчки

Продавачите могат да:
- Преглеждат поръчките към своите обяви
- Променят статуса на поръчките:
  - Изчаква
  - Потвърдена
  - Изпратена
  - Доставена
  - Отменена

Потребителите могат да:
- Преглеждат своите поръчки
- Следят статуса на поръчките

### 6.5. Система за съобщения

Потребителите могат да изпращат съобщения до продавачите на обяви:
1. Потребителят отваря детайли за обява
2. Изпраща съобщение чрез формата
3. Съобщението се записва в базата данни
4. Продавачът може да види съобщението в своята страница за съобщения

### 6.6. Система за ревюта

Потребителите могат да оставят ревюта за обяви:
- Рейтинг от 1 до 5 звезди
- Коментар
- Потребителите не могат да ревюират собствените си обяви

### 6.7. Многоезичност

Системата поддържа три езика:
- **Български** (по подразбиране)
- **Английски**
- **Руски**

Превключването на езика се осъществява чрез бутон в header-а. Всички текстове в интерфейса се обновяват динамично.

---

## 7. API Документация

### 7.1. Base URL

Development: `http://localhost:8080`  
Production: `https://webshop-backend.onrender.com`

### 7.2. Authentication Endpoints

#### 7.2.1. Регистрация

**POST** `/auth/register`

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "fullName": "Иван Иванов"
}
```

**Response (200 OK):**
```
REGISTER_OK
```

**Response (400 Bad Request):**
```
Email already in use!
```

#### 7.2.2. Вход

**POST** `/auth/login`

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
```

**Response (200 OK):**
```
LOGIN_OK
```

**Response (401 Unauthorized):**
```
Invalid email or password
```

### 7.3. Items Endpoints

#### 7.3.1. Получаване на всички обяви

**GET** `/items`

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "title": "Тениска",
    "description": "Нова тениска",
    "price": 50.0,
    "imageUrl": "data:image/jpeg;base64,...",
    "ownerEmail": "user@example.com",
    "category": "Дрехи",
    "contactEmail": "seller@example.com",
    "contactPhone": "+359888123456",
    "isVip": false,
    "paymentMethod": "cash_on_delivery"
  }
]
```

#### 7.3.2. Получаване на конкретна обява

**GET** `/items/{id}`

**Response (200 OK):**
```json
{
  "id": 1,
  "title": "Тениска",
  "description": "Нова тениска",
  "price": 50.0,
  "imageUrl": "data:image/jpeg;base64,...",
  "ownerEmail": "user@example.com",
  "category": "Дрехи",
  "contactEmail": "seller@example.com",
  "contactPhone": "+359888123456",
  "isVip": false,
  "paymentMethod": "cash_on_delivery",
  "reviews": []
}
```

#### 7.3.3. Създаване на обява

**POST** `/items`

**Request Body:**
```json
{
  "title": "Тениска",
  "description": "Нова тениска",
  "price": 50.0,
  "ownerEmail": "user@example.com",
  "category": "Дрехи",
  "contactEmail": "seller@example.com",
  "contactPhone": "+359888123456",
  "isVip": false,
  "paymentMethod": "cash_on_delivery"
}
```

**Response (200 OK):**
```json
{
  "id": 1,
  "title": "Тениска",
  "description": "Нова тениска",
  "price": 50.0,
  "ownerEmail": "user@example.com",
  "category": "Дрехи",
  "contactEmail": "seller@example.com",
  "contactPhone": "+359888123456",
  "isVip": false,
  "paymentMethod": "cash_on_delivery"
}
```

#### 7.3.4. Редактиране на обява

**PUT** `/items/{id}`

**Request Body:** (същото като при създаване)

**Response (200 OK):**
```json
{
  "id": 1,
  "title": "Обновена тениска",
  ...
}
```

#### 7.3.5. Изтриване на обява

**DELETE** `/items/{id}`

**Response (200 OK):**
```
Item deleted successfully
```

### 7.4. File Upload Endpoints

#### 7.4.1. Качване на снимка

**POST** `/upload/{itemId}`

**Content-Type:** `multipart/form-data`

**Form Data:**
- `file`: Файлът със снимката
- `ownerEmail`: Email на собственика на обявата

**Response (200 OK):**
```json
{
  "status": "success",
  "message": "Image uploaded successfully"
}
```

**Response (400 Bad Request):**
```json
{
  "error": "File is required",
  "status": "error"
}
```

**Response (413 Payload Too Large):**
```json
{
  "error": "Image is too large. Maximum size is 10MB.",
  "status": "error"
}
```

### 7.5. VIP Payment Endpoints

#### 7.5.1. Създаване на VIP плащане

**POST** `/vip-payment/create`

**Request Body:**
```json
{
  "itemId": 1,
  "ownerEmail": "user@example.com",
  "paymentMethod": "card",
  "cardNumber": "1234",
  "cardHolder": "ИВАН ИВАНОВ",
  "expiryDate": "12/25"
}
```

**Response (200 OK):**
```json
{
  "paymentId": 1,
  "itemId": 1,
  "amount": 2.0,
  "status": "PENDING",
  "message": "Payment created successfully"
}
```

#### 7.5.2. Завършване на VIP плащане

**POST** `/vip-payment/complete`

**Request Body:**
```json
{
  "paymentId": 1,
  "ownerEmail": "user@example.com",
  "paymentMethodId": null
}
```

**Response (200 OK):**
```json
{
  "paymentId": 1,
  "itemId": 1,
  "status": "COMPLETED",
  "message": "Payment completed and VIP status activated"
}
```

#### 7.5.3. Получаване на VIP цена

**GET** `/vip-payment/price`

**Response (200 OK):**
```json
{
  "price": 2.0,
  "currency": "EUR"
}
```

### 7.6. Order Endpoints

#### 7.6.1. Създаване на поръчка

**POST** `/item-orders`

**Request Body:**
```json
{
  "itemId": 1,
  "customerEmail": "customer@example.com",
  "customerName": "Петър Петров",
  "customerPhone": "+359888654321",
  "paymentMethod": "cash_on_delivery",
  "deliveryMethod": "speedy",
  "deliveryAddress": "ул. Примерна 123, София"
}
```

**Response (200 OK):**
```json
{
  "id": 1,
  "itemId": 1,
  "customerEmail": "customer@example.com",
  "customerName": "Петър Петров",
  "customerPhone": "+359888654321",
  "paymentMethod": "cash_on_delivery",
  "deliveryMethod": "speedy",
  "deliveryAddress": "ул. Примерна 123, София",
  "status": "PENDING"
}
```

#### 7.6.2. Получаване на поръчки

**GET** `/item-orders`

**Query Parameters:**
- `ownerEmail` (optional) - филтрира поръчките към обяви на конкретен потребител
- `customerEmail` (optional) - филтрира поръчките на конкретен потребител

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "itemId": 1,
    "customerEmail": "customer@example.com",
    "customerName": "Петър Петров",
    "customerPhone": "+359888654321",
    "paymentMethod": "cash_on_delivery",
    "deliveryMethod": "speedy",
    "deliveryAddress": "ул. Примерна 123, София",
    "status": "PENDING"
  }
]
```

#### 7.6.3. Обновяване на статус на поръчка

**PUT** `/item-orders/{id}/status`

**Request Body:**
```json
{
  "status": "CONFIRMED"
}
```

**Response (200 OK):**
```json
{
  "id": 1,
  "status": "CONFIRMED",
  "message": "Order status updated successfully"
}
```

### 7.7. Review Endpoints

#### 7.7.1. Получаване на ревюта за обява

**GET** `/items/{itemId}/reviews`

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "itemId": 1,
    "rating": 5,
    "comment": "Отлична обява!",
    "authorEmail": "reviewer@example.com"
  }
]
```

#### 7.7.2. Добавяне на ревю

**POST** `/items/{itemId}/reviews`

**Request Body:**
```json
{
  "rating": 5,
  "comment": "Отлична обява!",
  "authorEmail": "reviewer@example.com"
}
```

**Response (200 OK):**
```json
{
  "id": 1,
  "itemId": 1,
  "rating": 5,
  "comment": "Отлична обява!",
  "authorEmail": "reviewer@example.com"
}
```

### 7.8. Error Responses

Всички endpoints връщат стандартизирани error responses:

**400 Bad Request:**
```json
{
  "error": "Error message",
  "status": "error"
}
```

**401 Unauthorized:**
```
Invalid email or password
```

**403 Forbidden:**
```json
{
  "error": "You can only upload images to your own listings",
  "status": "error"
}
```

**404 Not Found:**
```
Item not found
```

**500 Internal Server Error:**
```json
{
  "error": "Internal server error message",
  "status": "error"
}
```

---

## 8. База данни

### 8.1. Database Schema

Системата използва H2 Database с file-based персистентност. Базата данни се съхранява в `backend/web-shop/data/webshopdb.mv.db`.

### 8.2. Entity Relationship Diagram

```
User
├── id (PK)
├── email (UNIQUE)
├── password (hashed)
└── fullName

Item
├── id (PK)
├── title
├── description
├── price
├── imageUrl (TEXT)
├── ownerEmail (FK -> User.email)
├── category
├── contactEmail
├── contactPhone
├── isVip
├── paymentMethod
└── reviews (OneToMany -> Review)

Review
├── id (PK)
├── itemId (FK -> Item.id)
├── rating
├── comment
└── authorEmail

ItemOrder
├── id (PK)
├── itemId (FK -> Item.id)
├── customerEmail
├── customerName
├── customerPhone
├── paymentMethod
├── deliveryMethod
├── deliveryAddress
└── status

VipPayment
├── id (PK)
├── itemId (FK -> Item.id)
├── ownerEmail
├── amount
├── paymentMethod
├── cardLastFour
├── cardHolder
├── expiryDate
├── status
└── completedAt

Message
├── id (PK)
├── itemId (FK -> Item.id)
├── senderEmail
├── receiverEmail
├── content
└── timestamp
```

### 8.3. Таблици

#### 8.3.1. USER

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| email | VARCHAR(255) | UNIQUE, NOT NULL | Email адрес на потребителя |
| password | VARCHAR(255) | NOT NULL | Хеширана парола (BCrypt) |
| full_name | VARCHAR(255) | | Пълно име на потребителя |

#### 8.3.2. ITEM

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| title | VARCHAR(255) | NOT NULL | Заглавие на обявата |
| description | TEXT | NOT NULL | Описание на обявата |
| price | DOUBLE | NOT NULL | Цена в EUR |
| image_url | TEXT | | Base64 encoded снимка |
| owner_email | VARCHAR(255) | | Email на собственика |
| category | VARCHAR(255) | | Категория на обявата |
| contact_email | VARCHAR(255) | | Контактен email |
| contact_phone | VARCHAR(255) | | Контактен телефон |
| is_vip | BOOLEAN | NOT NULL, DEFAULT FALSE | VIP статус |
| payment_method | VARCHAR(255) | | Начин на плащане |

#### 8.3.3. REVIEW

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| item_id | BIGINT | FOREIGN KEY -> Item.id | ID на обявата |
| rating | INT | NOT NULL | Рейтинг (1-5) |
| comment | TEXT | | Коментар |
| author_email | VARCHAR(255) | | Email на автора |

#### 8.3.4. ITEM_ORDER

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| item_id | BIGINT | FOREIGN KEY -> Item.id | ID на обявата |
| customer_email | VARCHAR(255) | NOT NULL | Email на клиента |
| customer_name | VARCHAR(255) | | Име на клиента |
| customer_phone | VARCHAR(255) | | Телефон на клиента |
| payment_method | VARCHAR(255) | | Начин на плащане |
| delivery_method | VARCHAR(255) | | Начин на доставка |
| delivery_address | TEXT | | Адрес за доставка |
| status | VARCHAR(255) | NOT NULL | Статус на поръчката |

#### 8.3.5. VIP_PAYMENT

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| item_id | BIGINT | FOREIGN KEY -> Item.id | ID на обявата |
| owner_email | VARCHAR(255) | NOT NULL | Email на собственика |
| amount | DOUBLE | NOT NULL | Сума (2.0 EUR) |
| payment_method | VARCHAR(255) | | Начин на плащане |
| card_last_four | VARCHAR(4) | | Последните 4 цифри на картата |
| card_holder | VARCHAR(255) | | Име на картодържателя |
| expiry_date | VARCHAR(5) | | Дата на изтичане (MM/YY) |
| status | VARCHAR(255) | NOT NULL | Статус на плащането |
| completed_at | TIMESTAMP | | Дата и час на завършване |

#### 8.3.6. MESSAGE

| Column | Type | Constraints | Description |
|--------|------|------------|-------------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Уникален идентификатор |
| item_id | BIGINT | FOREIGN KEY -> Item.id | ID на обявата |
| sender_email | VARCHAR(255) | NOT NULL | Email на изпращача |
| receiver_email | VARCHAR(255) | NOT NULL | Email на получателя |
| content | TEXT | NOT NULL | Съдържание на съобщението |
| timestamp | TIMESTAMP | NOT NULL | Дата и час на изпращане |

### 8.4. Индекси

Системата автоматично създава индекси за:
- `USER.email` (UNIQUE)
- `ITEM.owner_email`
- `REVIEW.item_id`
- `ITEM_ORDER.item_id`
- `VIP_PAYMENT.item_id`
- `MESSAGE.item_id`

### 8.5. Relationships

- **User → Item**: One-to-Many (един потребител може да има много обяви)
- **Item → Review**: One-to-Many (една обява може да има много ревюта)
- **Item → ItemOrder**: One-to-Many (една обява може да има много поръчки)
- **Item → VipPayment**: One-to-Many (една обява може да има много VIP плащания, но само едно активно)
- **Item → Message**: One-to-Many (една обява може да има много съобщения)

---

## 9. Frontend Архитектура

### 9.1. Структура на компонентите

Frontend-ът е организиран в следната структура:

```
src/
├── App.tsx                 # Главен компонент
├── App.css                 # Главни стилове
├── main.tsx               # Entry point
├── config.ts              # Конфигурация (API endpoints)
├── translations.ts        # Многоезични текстове
├── types.ts              # TypeScript типове
├── ErrorBoundary.tsx     # Error handling
└── components/
    ├── Header.tsx        # Header с навигация
    ├── RegisterPage.tsx  # Страница за регистрация
    ├── LoginPage.tsx     # Страница за вход
    ├── CreateListingForm.tsx  # Форма за създаване на обява
    ├── ItemList.tsx      # Списък с обяви
    ├── ItemCard.tsx      # Карта за обява
    ├── ItemDetail.tsx    # Детайли за обява
    ├── VipListingsPage.tsx  # Страница за VIP обяви
    ├── VipPaymentForm.tsx   # Форма за VIP плащане
    ├── MessagesPage.tsx  # Страница за съобщения
    └── OrdersPage.tsx    # Страница за поръчки
```

### 9.2. State Management

Frontend-ът използва React hooks за state management:

- **useState** - за локален state на компонентите
- **localStorage** - за персистентност на данните (loggedInEmail)
- **Props drilling** - за предаване на данни между компоненти

### 9.3. Routing

Рутирането се осъществява чрез условен рендеринг в `App.tsx`:

```typescript
{view === "all" && <ItemList ... />}
{view === "register" && <RegisterPage ... />}
{view === "login" && <LoginPage ... />}
{view === "detail" && <ItemDetail ... />}
// и т.н.
```

### 9.4. API Communication

Всички API заявки се извършват чрез `fetch` API:

```typescript
const res = await fetch(`${API_BASE}/items`, {
  method: "GET",
  headers: { "Content-Type": "application/json" }
});
```

### 9.5. Image Handling

Снимките се обработват по следния начин:
1. Потребителят избира файл
2. Frontend компресира снимката (ако е необходимо) до максимум 1920px
3. Frontend изпраща файла като `multipart/form-data`
4. Backend получава файла и го конвертира в base64
5. Base64 стрингът се записва в базата данни
6. Frontend показва снимката като data URI

### 9.6. Internationalization

Многоезичността се осъществява чрез:
- `translations.ts` файл с всички текстове за трите езика
- `language` state в `App.tsx`
- Динамично превключване на текстовете при промяна на езика

### 9.7. Error Handling

Грешките се обработват на няколко нива:
- **Try-catch блокове** в async функциите
- **Error state** в компонентите
- **ErrorBoundary** компонент за неочаквани грешки
- **User-friendly съобщения** за грешки

### 9.8. Form Validation

Валидацията се извършва както на frontend, така и на backend:
- **Frontend валидация** - за по-добър UX (незабавна обратна връзка)
- **Backend валидация** - за сигурност и data integrity

---

## 10. Backend Архитектура

### 10.1. Структура на пакетите

Backend-ът е организиран в следните пакети:

```
com.example.webshop/
├── WebShopApplication.java    # Главен клас
├── config/                   # Конфигурационни класове
│   ├── SecurityConfig.java
│   ├── CorsConfig.java
│   ├── MultipartConfig.java
│   └── WebConfig.java
├── controllers/              # REST Controllers
│   ├── AuthController.java
│   ├── ItemController.java
│   ├── FileUploadController.java
│   ├── OrderController.java
│   ├── VipController.java
│   └── VipPaymentController.java
├── services/                  # Business Logic
│   ├── UserService.java
│   ├── ItemService.java
│   ├── OrderService.java
│   ├── VipPaymentService.java
│   └── MessageService.java
├── repositories/              # Data Access Layer
│   ├── UserRepository.java
│   ├── ItemRepository.java
│   ├── OrderRepository.java
│   ├── VipPaymentRepository.java
│   └── MessageRepository.java
├── models/                    # Entity Classes
│   ├── User.java
│   ├── Item.java
│   ├── Review.java
│   ├── ItemOrder.java
│   ├── VipPayment.java
│   └── Message.java
└── dto/                       # Data Transfer Objects
    └── CreateItemOrderRequest.java
```

### 10.2. Controllers Layer

Controllers обработват HTTP заявките и връщат HTTP responses:

**AuthController:**
- `/auth/register` - Регистрация
- `/auth/login` - Вход

**ItemController:**
- `GET /items` - Получаване на всички обяви
- `GET /items/{id}` - Получаване на конкретна обява
- `POST /items` - Създаване на обява
- `PUT /items/{id}` - Редактиране на обява
- `DELETE /items/{id}` - Изтриване на обява

**FileUploadController:**
- `POST /upload/{itemId}` - Качване на снимка

**VipPaymentController:**
- `POST /vip-payment/create` - Създаване на VIP плащане
- `POST /vip-payment/complete` - Завършване на VIP плащане
- `GET /vip-payment/price` - Получаване на VIP цена

**OrderController:**
- `POST /item-orders` - Създаване на поръчка
- `GET /item-orders` - Получаване на поръчки
- `PUT /item-orders/{id}/status` - Обновяване на статус

### 10.3. Services Layer

Services съдържат бизнес логиката:

**UserService:**
- `register()` - Регистрация на нов потребител
- `login()` - Вход на потребител

**ItemService:**
- `create()` - Създаване на обява
- `getAll()` - Получаване на всички обяви (сортирани)
- `getById()` - Получаване на обява по ID
- `update()` - Редактиране на обява
- `delete()` - Изтриване на обява

**VipPaymentService:**
- `createPayment()` - Създаване на VIP плащане
- `completePayment()` - Завършване на VIP плащане
- `hasCompletedPayment()` - Проверка за завършено плащане
- `getVipPrice()` - Получаване на VIP цена

**OrderService:**
- `createOrder()` - Създаване на поръчка
- `getAllOrders()` - Получаване на всички поръчки
- `updateStatus()` - Обновяване на статус на поръчка

### 10.4. Repositories Layer

Repositories предоставят достъп до базата данни:

- **UserRepository** - CRUD операции за User
- **ItemRepository** - CRUD операции за Item
- **VipPaymentRepository** - CRUD операции за VipPayment
- **OrderRepository** - CRUD операции за ItemOrder
- **MessageRepository** - CRUD операции за Message

### 10.5. Models Layer

Models представляват ентитетите в базата данни:

- **User** - Потребител
- **Item** - Обява
- **Review** - Ревю
- **ItemOrder** - Поръчка
- **VipPayment** - VIP плащане
- **Message** - Съобщение

### 10.6. Transaction Management

Всички операции, които променят данните в базата, са обвити в `@Transactional`:
- Гарантира ACID свойства
- Автоматичен rollback при грешка
- Изолиране на транзакциите

### 10.7. Exception Handling

Грешките се обработват на няколко нива:
- **Controller level** - HTTP status codes и error messages
- **Service level** - Business logic exceptions
- **Repository level** - Database exceptions

### 10.8. Security Configuration

Security е конфигуриран в `SecurityConfig.java`:
- CSRF защитата е изключена (за REST API)
- CORS е разрешен за всички origins
- Всички endpoints са публични (permitAll)
- Session management е stateless

---

## 11. Сигурност

### 11.1. Authentication

Системата използва session-based authentication:
- Email и парола за вход
- Паролите се хешират с BCrypt
- Email се запазва в localStorage (не е идеално за production)

### 11.2. Password Security

Паролите се хешират с BCrypt:
- Salt rounds: 10 (по подразбиране)
- Еднопосочно хеширане
- Невъзможност за декриптиране

### 11.3. Input Validation

Всички входни данни се валидират:
- **Frontend валидация** - за по-добър UX
- **Backend валидация** - за сигурност

### 11.4. SQL Injection Protection

Използването на JPA/Hibernate предотвратява SQL injection:
- Parameterized queries
- Entity mapping
- Type-safe queries

### 11.5. XSS Protection

XSS защитата се осъществява чрез:
- Escaping на user input
- React автоматично escape-ва HTML
- Content Security Policy (CSP) headers

### 11.6. CORS Configuration

CORS е конфигуриран да позволява заявки от всички origins:
- За development това е удобно
- За production трябва да се ограничи до конкретни домейни

### 11.7. File Upload Security

Качването на файлове е защитено:
- Проверка за размер (максимум 10MB)
- Проверка за тип (само изображения)
- Валидация на собственика на обявата
- Base64 encoding за безопасно съхранение

### 11.8. Payment Security

VIP плащанията са защитени:
- Интеграция със Stripe (PCI DSS compliant)
- Само последните 4 цифри на картата се съхраняват
- CVV не се съхранява
- Плащанията се обработват чрез Stripe API

### 11.9. Recommendations за Production

За production среда се препоръчва:
- Използване на JWT tokens вместо localStorage
- HTTPS за всички комуникации
- Rate limiting за API endpoints
- Logging и monitoring
- Регулярни security audits
- Backup на базата данни

---

## 12. Тестване

### 12.1. Видове тестове

#### 12.1.1. Unit Tests

Unit тестове за отделни компоненти и функции:
- Service layer тестове
- Utility функции тестове
- Component тестове (React)

#### 12.1.2. Integration Tests

Integration тестове за взаимодействието между компоненти:
- Controller-Service-Repository тестове
- API endpoint тестове
- Database integration тестове

#### 12.1.3. End-to-End Tests

E2E тестове за пълни потребителски сценарии:
- Регистрация → Създаване на обява → Поръчка
- Вход → VIP плащане → Активиране на VIP

### 12.2. Test Coverage

Целта е поне 70% code coverage за:
- Backend services
- Backend controllers
- Frontend components
- Utility функции

### 12.3. Manual Testing

Ръчно тестване на следните сценарии:
- Регистрация и вход
- Създаване на обява
- Качване на снимка
- VIP плащане
- Създаване на поръчка
- Промяна на статус на поръчка
- Многоезичност

### 12.4. Performance Testing

Тестване на производителността:
- Response times на API endpoints
- Page load times
- Image upload performance
- Database query performance

### 12.5. Security Testing

Тестване на сигурността:
- SQL injection attempts
- XSS attempts
- CSRF protection
- Authentication bypass attempts
- File upload security

---

## 13. Разполагане

### 13.1. Frontend Deployment (Vercel)

#### 13.1.1. Подготовка

1. Build на frontend:
```bash
cd web-shop-frontend
npm run build
```

2. Конфигуриране на environment variables в Vercel:
- `VITE_API_BASE` - Backend API URL

#### 13.1.2. Deployment

1. Свързване на GitHub repository с Vercel
2. Конфигуриране на build settings:
   - Build Command: `npm run build`
   - Output Directory: `dist`
3. Automatic deployments при push към main branch

### 13.2. Backend Deployment (Render.com)

#### 13.2.1. Подготовка

1. Създаване на `Procfile`:
```
web: java -jar target/web-shop-0.0.1-SNAPSHOT.jar
```

2. Конфигуриране на environment variables:
- `STRIPE_SECRET_KEY` - Stripe secret key
- `SPRING_PROFILES_ACTIVE` - production

#### 13.2.2. Deployment

1. Свързване на GitHub repository с Render
2. Конфигуриране на build settings:
   - Build Command: `mvn clean install`
   - Start Command: `java -jar target/web-shop-0.0.1-SNAPSHOT.jar`
3. Конфигуриране на health check endpoint

### 13.3. Database Persistence

H2 Database се съхранява в `data/webshopdb.mv.db`:
- Файлът се съхранява в persistent storage на Render
- Регулярни backups се препоръчват

### 13.4. Environment Configuration

#### 13.4.1. Development

```properties
spring.profiles.active=development
spring.datasource.url=jdbc:h2:file:./data/webshopdb
```

#### 13.4.2. Production

```properties
spring.profiles.active=production
spring.datasource.url=jdbc:h2:file:./data/webshopdb
logging.level.root=INFO
```

### 13.5. Monitoring

Препоръчва се използването на:
- Application logs
- Error tracking (Sentry, Rollbar)
- Performance monitoring (New Relic, Datadog)
- Uptime monitoring

### 13.6. Backup Strategy

Регулярни backups на:
- Database файл (`webshopdb.mv.db`)
- Uploaded files (ако се използва файлова система)
- Configuration files

---

## 14. Бъдещи подобрения

### 14.1. Функционални подобрения

1. **По-добра автентификация**
   - JWT tokens вместо localStorage
   - Refresh tokens
   - Password reset functionality
   - Email verification

2. **Търсене и филтриране**
   - Full-text search
   - Разширени филтри (цена, категория, локация)
   - Сортиране по различни критерии

3. **Уведомления**
   - Email уведомления за нови поръчки
   - In-app уведомления
   - Push notifications

4. **Социални функции**
   - Следване на потребители
   - Любими обяви
   - Споделяне в социални мрежи

5. **Административен панел**
   - Dashboard за статистика
   - Управление на потребители
   - Модерация на обяви

### 14.2. Технически подобрения

1. **База данни**
   - Миграция към PostgreSQL или MySQL
   - Database migrations (Flyway, Liquibase)
   - Connection pooling

2. **Caching**
   - Redis за caching
   - Cache на често достъпвани данни
   - CDN за статични файлове

3. **Performance**
   - Image optimization (WebP формат)
   - Lazy loading на изображения
   - Code splitting
   - API response caching

4. **Testing**
   - Автоматизирани тестове
   - CI/CD pipeline
   - Automated deployment

5. **Monitoring**
   - Application Performance Monitoring (APM)
   - Error tracking
   - Analytics

### 14.3. UI/UX подобрения

1. **Responsive Design**
   - По-добра поддръжка на мобилни устройства
   - Touch-friendly интерфейс
   - Progressive Web App (PWA)

2. **Accessibility**
   - ARIA labels
   - Keyboard navigation
   - Screen reader support

3. **Design System**
   - Consistent design language
   - Component library
   - Design tokens

---

## 15. Приложения

### Приложение A: Глосар

**API (Application Programming Interface)** - Набор от правила и протоколи за комуникация между софтуерни компоненти.

**BCrypt** - Алгоритъм за хеширане на пароли, използващ salt за повишаване на сигурността.

**CORS (Cross-Origin Resource Sharing)** - Механизъм, който позволява на уеб страници да правят заявки към домейни, различни от този, който ги е обслужил.

**CSRF (Cross-Site Request Forgery)** - Тип атака, при която злонамерен уебсайт кара потребителя да изпълни нежелани действия в приложение, в което е логнат.

**DTO (Data Transfer Object)** - Обект, използван за пренос на данни между слоевете на приложението.

**Entity** - Обект, който представлява таблица в базата данни.

**JPA (Java Persistence API)** - Java спецификация за управление на релационни данни в Java приложения.

**JWT (JSON Web Token)** - Отворен стандарт за безопасно предаване на информация между страни като JSON обект.

**Lazy Loading** - Техника за зареждане на данни само когато са необходими.

**Multipart Form Data** - Тип на HTTP заявка, използван за качване на файлове.

**PCI DSS (Payment Card Industry Data Security Standard)** - Стандарт за сигурност на данни за индустрията на платежните карти.

**REST (Representational State Transfer)** - Архитектурен стил за дизайн на уеб услуги.

**Repository Pattern** - Design pattern, който абстрахира достъпа до данни.

**Service Layer** - Слой в архитектурата, който съдържа бизнес логиката.

**Stripe** - Платформа за обработка на онлайн плащания.

**Transaction** - Група от операции, които се изпълняват като една единица.

**XSS (Cross-Site Scripting)** - Тип атака, при която злонамерен код се инжектира в уеб страница.

### Приложение B: Използвани библиотеки и зависимости

#### Backend Dependencies

- Spring Boot Starter Web 3.2.2
- Spring Boot Starter Security 3.2.2
- Spring Boot Starter Data JPA 3.2.2
- H2 Database
- Stripe Java SDK 24.16.0
- Commons FileUpload 1.5
- Commons IO 2.15.1
- JWT (jjwt) 0.11.5

#### Frontend Dependencies

- React 19.2.0
- React DOM 19.2.0
- TypeScript 5.9.3
- Vite 7.2.4
- ESLint 9.39.1

### Приложение C: Полезни команди

#### Backend

```bash
# Компилиране
mvn clean install

# Стартиране
mvn spring-boot:run

# Тестване
mvn test

# Packaging
mvn package
```

#### Frontend

```bash
# Инсталиране на зависимости
npm install

# Development server
npm run dev

# Build за production
npm run build

# Linting
npm run lint

# Preview на production build
npm run preview
```

### Приложение D: Контакти и поддръжка

**Разработчик:** Георги Лазаров  
**Email:** [email]  
**GitHub:** https://github.com/GeorgiL1234/Diplomnarabota

### Приложение E: Лиценз

[Посочете лиценза на проекта]

### Приложение F: История на версиите

**Версия 1.0 (Февруари 2026)**
- Първоначална версия
- Основни функционалности за управление на обяви
- VIP система с плащания
- Многоезичност
- Система за поръчки и съобщения

### Приложение G: Code Examples

#### G.1. Frontend - Създаване на обява

```typescript
const handleCreateListing = async (e: FormEvent) => {
  e.preventDefault();
  
  // Валидация
  if (!newItemTitle.trim() || !newItemDescription.trim()) {
    setError("Моля, попълнете всички задължителни полета");
    return;
  }
  
  // Компресиране на снимката
  let fileToUpload = newItemFile;
  if (fileToUpload) {
    fileToUpload = await compressImage(fileToUpload, 2);
  }
  
  // Създаване на обявата
  const res = await fetch(`${API_BASE}/items`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      title: newItemTitle,
      description: newItemDescription,
      price: parseFloat(newItemPrice),
      ownerEmail: loggedInEmail,
      category: newItemCategory,
      contactEmail: newItemContactEmail,
      contactPhone: newItemContactPhone,
      paymentMethod: newItemPaymentMethod,
      isVip: newItemIsVip,
    }),
  });
  
  const createdItem = await res.json();
  
  // Качване на снимката
  if (fileToUpload && createdItem.id) {
    const formData = new FormData();
    formData.append("file", fileToUpload);
    formData.append("ownerEmail", loggedInEmail);
    
    await fetch(`${API_BASE}/upload/${createdItem.id}`, {
      method: "POST",
      body: formData,
    });
  }
};
```

#### G.2. Backend - UserService Register

```java
@Transactional(readOnly = false, timeout = 5)
public User register(String email, String password, String fullName) {
    // Проверка за съществуващ email
    if (userRepository.existsByEmail(email)) {
        throw new RuntimeException("Email already in use!");
    }

    // Хеширане на паролата
    String encodedPassword = passwordEncoder.encode(password);
    logger.debug("Encoded password for email {}: {}", email, encodedPassword);

    // Създаване на нов потребител
    User newUser = new User(email, encodedPassword, fullName);
    User saved = userRepository.save(newUser);
    logger.debug("User saved with ID: {}", saved.getId());
    return saved;
}
```

#### G.3. Image Compression (Frontend)

```typescript
const compressImage = (file: File, maxSizeMB: number = 2): Promise<File> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        let width = img.width;
        let height = img.height;
        
        // Максимална ширина/височина 1920px
        const maxDimension = 1920;
        if (width > maxDimension || height > maxDimension) {
          if (width > height) {
            height = (height / width) * maxDimension;
            width = maxDimension;
          } else {
            width = (width / height) * maxDimension;
            height = maxDimension;
          }
        }
        
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        
        // Компресиране до желания размер
        canvas.toBlob((blob) => {
          if (blob) {
            resolve(new File([blob], file.name, { type: 'image/jpeg' }));
          } else {
            reject(new Error('Compression failed'));
          }
        }, 'image/jpeg', 0.9);
      };
      img.src = e.target?.result as string;
    };
    reader.readAsDataURL(file);
  });
};
```

### Приложение H: Диаграми и схеми

#### H.1. Sequence Diagram - Създаване на обява с VIP плащане

```
User          Frontend          Backend          Database         Stripe
 │               │                 │                │              │
 │--Fill Form--->│                 │                │              │
 │               │--POST /items--->│                │              │
 │               │                 │--Save Item---->│              │
 │               │<--Item Created--│<--Item ID------│              │
 │               │                 │                │              │
 │--Upload Image->│--POST /upload-->│                │              │
 │               │                 │--Save Image--->│              │
 │               │<--Image Saved---│<--Success------│              │
 │               │                 │                │              │
 │--Fill Payment->│--POST /vip-payment/create->│                │              │
 │               │                 │--Create Payment->│              │
 │               │<--Payment ID----│<--Payment------│              │
 │               │                 │                │              │
 │--Submit------>│--POST /vip-payment/complete->│                │              │
 │               │                 │--Process Payment->│              │--Charge Card->│
 │               │                 │                │              │<--Success-----│
 │               │                 │--Activate VIP->│              │              │
 │               │<--VIP Activated│<--Success------│              │              │
 │<--Success-----│                 │                │              │              │
```

#### H.2. Class Diagram - Backend Models

```
┌─────────────┐
│    User     │
├─────────────┤
│ +id: Long   │
│ +email: Str │
│ +password:  │
│ +fullName:  │
└─────────────┘
       │
       │ 1
       │
       │ *
┌─────────────┐
│    Item     │
├─────────────┤
│ +id: Long   │
│ +title: Str │
│ +price: Dbl │
│ +isVip: Bool│
└─────────────┘
       │
       │ 1
       │
       │ *
┌─────────────┐      ┌──────────────┐
│   Review    │      │  VipPayment  │
├─────────────┤      ├──────────────┤
│ +rating: Int│      │ +amount: Dbl │
│ +comment:   │      │ +status: Str │
└─────────────┘      └──────────────┘
```

### Приложение I: Troubleshooting Guide

#### I.1. Често срещани проблеми

**Проблем:** Регистрацията забива или е бавна
- **Решение:** Проверете дали базата данни е достъпна. Проверете logs за database connection errors.

**Проблем:** Снимките не се качват
- **Решение:** 
  1. Проверете размера на файла (максимум 10MB)
  2. Проверете дали endpoint-ът е достъпен
  3. Проверете CORS конфигурацията
  4. Проверете multipart configuration

**Проблем:** VIP плащането не работи
- **Решение:**
  1. Проверете дали Stripe secret key е конфигуриран
  2. Проверете дали картата е валидна (Luhn алгоритъм)
  3. Проверете network tab за API errors

**Проблем:** Многоезичността не работи
- **Решение:** Проверете дали `translations.ts` съдържа всички необходими ключове за избрания език.

#### I.2. Debugging Tips

1. **Frontend Debugging:**
   - Използвайте browser DevTools (F12)
   - Проверявайте Console за errors
   - Проверявайте Network tab за failed requests
   - Използвайте React DevTools extension

2. **Backend Debugging:**
   - Проверявайте application logs
   - Използвайте H2 Console за проверка на данните
   - Добавете breakpoints в IDE
   - Проверявайте Spring Boot Actuator endpoints

3. **Database Debugging:**
   - Отворете H2 Console на `http://localhost:8080/h2-console`
   - Проверете данните директно в базата
   - Проверете за foreign key constraints

### Приложение J: Performance Optimization

#### J.1. Frontend Optimizations

1. **Image Optimization:**
   - Компресиране на изображения преди качване
   - Използване на WebP формат (бъдещо подобрение)
   - Lazy loading на изображения
   - Responsive images (srcset)

2. **Code Splitting:**
   - Разделяне на компонентите в отделни chunks
   - Dynamic imports за по-редко използвани компоненти
   - Tree shaking за премахване на неизползван код

3. **Caching:**
   - Browser caching за статични ресурси
   - Service Workers за offline support (бъдещо подобрение)
   - LocalStorage caching за често достъпвани данни

#### J.2. Backend Optimizations

1. **Database Optimizations:**
   - Индекси за често търсени колони
   - Connection pooling
   - Query optimization
   - Pagination за големи резултати

2. **Caching:**
   - Redis за caching на често достъпвани данни
   - Spring Cache abstraction
   - HTTP response caching

3. **API Optimizations:**
   - Compression (gzip)
   - Pagination
   - Field selection (projection)
   - Batch operations

### Приложение K: Best Practices

#### K.1. Code Quality

1. **Naming Conventions:**
   - Java: camelCase за променливи, PascalCase за класове
   - TypeScript: camelCase за променливи и функции, PascalCase за компоненти
   - Constants: UPPER_SNAKE_CASE

2. **Comments:**
   - Коментирайте сложна бизнес логика
   - Избягвайте очевидни коментари
   - Използвайте JSDoc за функции

3. **Error Handling:**
   - Винаги обработвайте грешки
   - Предоставяйте ясни error messages
   - Логирайте грешки за debugging

#### K.2. Security Best Practices

1. **Authentication:**
   - Използвайте JWT tokens вместо localStorage
   - Реализирайте refresh tokens
   - Добавете rate limiting

2. **Input Validation:**
   - Валидирайте всички входни данни
   - Използвайте whitelist вместо blacklist
   - Sanitize user input

3. **Data Protection:**
   - Не съхранявайте чувствителни данни в plain text
   - Използвайте HTTPS за всички комуникации
   - Регулярни security audits

### Приложение L: API Response Examples

#### L.1. Успешен Response

```json
{
  "status": "success",
  "data": {
    "id": 1,
    "title": "Тениска",
    "price": 50.0
  },
  "message": "Operation completed successfully"
}
```

#### L.2. Error Response

```json
{
  "status": "error",
  "error": "Validation failed",
  "message": "Title is required",
  "code": "VALIDATION_ERROR"
}
```

### Приложение M: Database Queries Examples

#### M.1. Намиране на всички VIP обяви

```sql
SELECT * FROM ITEM WHERE IS_VIP = TRUE ORDER BY ID DESC;
```

#### M.2. Намиране на обяви по категория

```sql
SELECT * FROM ITEM WHERE CATEGORY = 'Дрехи' ORDER BY IS_VIP DESC, ID DESC;
```

#### M.3. Намиране на поръчки за конкретен потребител

```sql
SELECT o.* FROM ITEM_ORDER o 
JOIN ITEM i ON o.ITEM_ID = i.ID 
WHERE i.OWNER_EMAIL = 'user@example.com';
```

### Приложение N: Environment Configuration Examples

#### N.1. Development Environment

```properties
# application-dev.properties
spring.datasource.url=jdbc:h2:file:./data/webshopdb
spring.jpa.show-sql=true
logging.level.com.example.webshop=DEBUG
```

#### N.2. Production Environment

```properties
# application-prod.properties
spring.datasource.url=jdbc:h2:file:./data/webshopdb
spring.jpa.show-sql=false
logging.level.root=INFO
stripe.secret.key=${STRIPE_SECRET_KEY}
```

### Приложение O: Testing Scenarios

#### O.1. User Registration Test

1. Отворете регистрационна форма
2. Попълнете валидни данни
3. Натиснете "Регистрация"
4. Очакван резултат: Успешна регистрация и автоматичен вход

#### O.2. VIP Payment Test

1. Създайте обява с избран VIP статус
2. Попълнете формата за плащане
3. Въведете валидни данни за карта
4. Натиснете "Плати"
5. Очакван резултат: VIP статус активиран, обявата се показва първа

#### O.3. Image Upload Test

1. Създайте обява
2. Изберете снимка (под 10MB)
3. Качете снимката
4. Очакван резултат: Снимката се показва в обявата

### Приложение P: Glossary (Extended)

**API Endpoint** - URL адрес, към който се изпращат HTTP заявки за достъп до функционалност на сървъра.

**Base64 Encoding** - Метод за кодиране на двоични данни като текст, използван за предаване на изображения чрез JSON.

**BCrypt** - Адаптивна хешираща функция за пароли, проектирана от Niels Provos и David Mazières.

**CORS (Cross-Origin Resource Sharing)** - Механизъм, който позволява на уеб страници да правят заявки към домейни, различни от този, който ги е обслужил.

**CSRF (Cross-Site Request Forgery)** - Тип атака, при която злонамерен уебсайт кара потребителя да изпълни нежелани действия.

**DTO (Data Transfer Object)** - Обект, използван за пренос на данни между слоевете на приложението без излагане на вътрешната структура.

**Entity** - Обект, който представлява таблица в базата данни и има жизнен цикъл, управляван от JPA.

**H2 Database** - Лека, вградена релационна база данни, написана на Java.

**JPA (Java Persistence API)** - Java спецификация за управление на релационни данни в Java приложения.

**JWT (JSON Web Token)** - Отворен стандарт (RFC 7519) за безопасно предаване на информация между страни като JSON обект.

**Lazy Loading** - Техника за зареждане на данни само когато са необходими, за да се подобри производителността.

**Luhn Algorithm** - Алгоритъм за валидиране на номера на кредитни карти.

**Multipart Form Data** - Тип на HTTP заявка, използван за качване на файлове и данни от форми.

**PCI DSS** - Стандарт за сигурност на данни за индустрията на платежните карти.

**REST (Representational State Transfer)** - Архитектурен стил за дизайн на уеб услуги, базиран на HTTP протокола.

**Repository Pattern** - Design pattern, който абстрахира достъпа до данни и предоставя по-обектно-ориентиран интерфейс.

**Service Layer** - Слой в архитектурата, който съдържа бизнес логиката и действа като посредник между controllers и repositories.

**Stripe** - Платформа за обработка на онлайн плащания, която предоставя API за приемане на плащания.

**Transaction** - Група от операции, които се изпълняват като една единица - или всички успешно, или всички се отменят.

**XSS (Cross-Site Scripting)** - Тип атака, при която злонамерен код се инжектира в уеб страница.

### Приложение Q: Deployment Checklist

#### Q.1. Pre-Deployment

- [ ] Всички тестове минават успешно
- [ ] Code review е завършен
- [ ] Environment variables са конфигурирани
- [ ] Database migrations са приложени
- [ ] SSL сертификати са инсталирани
- [ ] Backup стратегия е налична

#### Q.2. Deployment

- [ ] Frontend build е успешен
- [ ] Backend build е успешен
- [ ] Deployment на frontend (Vercel)
- [ ] Deployment на backend (Render)
- [ ] Health checks минават
- [ ] Smoke tests минават

#### Q.3. Post-Deployment

- [ ] Мониторинг е конфигуриран
- [ ] Error tracking е активен
- [ ] Performance monitoring е активен
- [ ] Backup е тестван
- [ ] Rollback план е готов

### Приложение R: Code Style Guide

#### R.1. Java Code Style

```java
// Класове: PascalCase
public class UserService {
    // Константи: UPPER_SNAKE_CASE
    private static final int MAX_RETRIES = 3;
    
    // Методи: camelCase
    public User register(String email, String password) {
        // Локални променливи: camelCase
        String encodedPassword = passwordEncoder.encode(password);
        return userRepository.save(newUser);
    }
}
```

#### R.2. TypeScript Code Style

```typescript
// Компоненти: PascalCase
export function UserProfile({ userId }: UserProfileProps) {
    // Променливи: camelCase
    const [user, setUser] = useState<User | null>(null);
    
    // Константи: UPPER_SNAKE_CASE
    const MAX_ITEMS = 10;
    
    // Функции: camelCase
    const fetchUser = async () => {
        // ...
    };
}
```

### Приложение S: Performance Benchmarks

#### S.1. API Response Times

- GET /items: < 200ms
- POST /items: < 500ms
- POST /upload/{id}: < 2000ms (зависи от размера на файла)
- POST /vip-payment/complete: < 1000ms

#### S.2. Frontend Metrics

- First Contentful Paint: < 1.5s
- Time to Interactive: < 3s
- Largest Contentful Paint: < 2.5s

### Приложение T: Security Checklist

- [ ] Паролите се хешират с BCrypt
- [ ] Всички входни данни се валидират
- [ ] SQL injection защита (JPA)
- [ ] XSS защита (React escaping)
- [ ] CSRF защита (изключена за REST API)
- [ ] HTTPS за всички комуникации
- [ ] Чувствителни данни не се съхраняват в plain text
- [ ] Регулярни security updates
- [ ] Error messages не разкриват чувствителна информация

---

## 16. Използвана литература и ресурси

### 16.1. Официална документация

- Spring Boot Documentation: https://spring.io/projects/spring-boot
- React Documentation: https://react.dev/
- TypeScript Documentation: https://www.typescriptlang.org/docs/
- Stripe API Documentation: https://stripe.com/docs/api
- H2 Database Documentation: https://www.h2database.com/html/main.html

### 16.2. Онлайн ресурси

- MDN Web Docs: https://developer.mozilla.org/
- Stack Overflow: https://stackoverflow.com/
- GitHub: https://github.com/

### 16.3. Книги и статии

- "Spring Boot in Action" - Craig Walls
- "Learning React" - Alex Banks, Eve Porcello
- "Effective Java" - Joshua Bloch

---

## 17. Заключение

Настоящата документация предоставя пълно описание на Web Shop платформата - от архитектурата и технологичния стек до детайлно описание на функционалностите и API endpoints. Системата е разработена с използване на съвременни технологии и следва best practices за уеб разработка.

### 17.1. Постигнати цели

- ✅ Пълнофункционална платформа за обяви
- ✅ Безопасна автентификация и авторизация
- ✅ VIP система с плащания
- ✅ Многоезичност
- ✅ Responsive design
- ✅ Добра производителност

### 17.2. Бъдещи насоки

Системата има потенциал за разширяване в много направления:
- По-добра автентификация с JWT
- Разширени функции за търсене и филтриране
- Социални функции
- Мобилно приложение
- Административен панел

### 17.3. Благодарности

Благодарности на всички, които са допринесли за разработката на проекта.

---

**Край на документацията**

*Документацията е създадена на Февруари 2026 и е актуална за версия 1.0 на системата.*

**Общ брой страници:** Приблизително 60+ страници (при стандартен формат A4, 12pt шрифт, двойно разстояние)

**Последна актуализация:** Февруари 2026
